paths:
  /api/billetera/saldo/{id}:
    get:
      tags:
        - Billetera
      summary: Obtener saldo de la billetera
      description: Consulta el saldo actual de la billetera de un usuario específico
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: ID del usuario
          example: 123
      responses:
        "200":
          description: Saldo obtenido exitosamente
          content:
            application/json:
              schema:
                type: object
                properties:
                  usuario:
                    type: integer
                    example: 123
                    description: ID del usuario
                  saldo:
                    type: number
                    format: decimal
                    example: 500.00
                    description: Saldo actual en la billetera
        "400":
          description: usuarioId requerido
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "usuarioId requerido"
        "500":
          description: Error interno del servidor
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Error interno del servidor"

  /api/billetera/recargar:
    post:
      tags:
        - Billetera
      summary: Recargar billetera
      description: Agrega dinero a la billetera del usuario para comprar tickets de lotería
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - id
                - monto
              properties:
                id:
                  type: integer
                  example: 123
                  description: ID del usuario que recarga la billetera
                monto:
                  type: number
                  format: decimal
                  minimum: 0.01
                  example: 100.00
                  description: Cantidad a recargar (debe ser mayor que 0)
      responses:
        "200":
          description: Saldo recargado exitosamente
          content:
            application/json:
              schema:
                type: object
                properties:
                  mensaje:
                    type: string
                    example: "Saldo acreditado correctamente"
                  billetera:
                    type: object
                    description: Información actualizada de la billetera
                    properties:
                      id:
                        type: integer
                        example: 1
                      usuario:
                        type: integer
                        example: 123
                      saldo:
                        type: number
                        format: decimal
                        example: 600.00
                      actualizada:
                        type: string
                        format: date-time
                        example: "2024-11-08T10:30:00Z"
        "400":
          description: Error en validación de datos
          content:
            application/json:
              schema:
                oneOf:
                  - type: array
                    description: Errores de validación
                    items:
                      type: object
                      properties:
                        msg:
                          type: string
                          example: "usuarioId es requerido"
                        param:
                          type: string
                          example: "usuarioId"
                        location:
                          type: string
                          example: "body"
                  - type: object
                    properties:
                      error:
                        type: string
                        example: "usuarioId y monto son requeridos"

  /api/billetera/paypal/crear:
    post:
      tags:
        - Billetera
      summary: Crear orden PayPal para recarga
      description: Crea una orden de PayPal (intent CAPTURE) para recargar saldo; devuelve el approveUrl.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [id, monto]
              properties:
                id:
                  type: integer
                  example: 123
                monto:
                  type: number
                  example: 25.50
                currency:
                  type: string
                  example: USD
      responses:
        "200":
          description: Orden creada
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    example: "5O190127TN364715T"
                  status:
                    type: string
                    example: "CREATED"
                  approveUrl:
                    type: string
                    example: "https://www.sandbox.paypal.com/checkoutnow?token=5O190127TN364715T"
        "400":
          description: Error de validación
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/billetera/paypal/capturar:
    post:
      tags:
        - Billetera
      summary: Capturar orden PayPal y acreditar saldo
      description: Captura una orden aprobada y acredita el monto a la billetera del usuario.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [orden]
              properties:
                orden:
                  type: string
                  example: "5O190127TN364715T"
                usuario:
                  type: integer
                  example: 123
                  description: Opcional si se envió custom_id en create-order
      responses:
        "200":
          description: Orden capturada y saldo acreditado
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                    example: true
                  billetera:
                    type: object
                    properties:
                      id:
                        type: integer
                        example: 1
                      usuario:
                        type: integer
                        example: 123
                      saldo:
                        type: number
                        example: 125.50
                  mensaje:
                    type: string
                    example: "Recarga completada"
        "400":
          description: Error en captura
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
